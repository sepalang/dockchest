defines:
  - &NAME doch-mysql
  - &VERSION 0.0.1
  - &HOST "*"
  - &C_SERVER_PORT 3306
  - &H_SERVER_PORT 3306
arg:
  SERVER_PORT: *C_SERVER_PORT
build:
  tag: [*NAME, *VERSION]
  script: |
    FROM mysql:latest
    ARG MYSQL_ROOT_PASSWORD
    ENV MYSQL_ROOT_PASSWORD $MYSQL_ROOT_PASSWORD
    EXPOSE 3306
    COPY ./docker-entrypoint-initdb.d /docker-entrypoint-initdb.d
run:
  name: "live-server"
  publishes: 
    - [*H_SERVER_PORT, *C_SERVER_PORT]
  volumes: 
    - [../volume, /usr/src/app/volume]
  labels:
    - "traefik.enable=true"
    - ["traefik.tcp.routers.db.rule=HostSNI(`", &HOST, "`)"]
    - ["traefik.tcp.services.db.loadbalancer.server.port=", &H_SERVER_PORT]
    - ["traefik.tcp.routers.db.entrypoints=mysql"]
